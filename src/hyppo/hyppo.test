# Hypervisor test script

# First a very simple test, where we just make sure that
# memory locations get set, and register values are correct
# at the end.
test "Reset display correctly sets VIC-IV registers"
loadhyppo bin/HICKUP.M65
loadhypposymbols src/hyppo/HICKUP.sym
jsr resetdisplay
expect $1B at $D011
expect $C8 at $D016
expect $14 at $D018
expect $40 at $D030
expect $E5 at $D054
expect $50 at $D058
expect $78 at $D05A
expect $50 at $D05C
expect $C0 at $D05D
expect $80 at $D06F
expect $FF at $DD00
expect $FF at $DD01
expect $A9 at resetdisplay
expect pc = $0001
expect spl = $01
check ram
check registers
test end

# Now let's start testing things more seriously, beginning with the reset
# entry point.

test "reset_entry calls launch_flash_menu on first boot"
# Stop whichever way it goes
loadhyppo bin/HICKUP.M65
loadhypposymbols src/hyppo/HICKUP.sym
breakpoint first_boot_flag_instruction+3
breakpoint dont_launch_flash_menu
jmp reset_entry
expect pc = launch_flash_menu
check registers
test end